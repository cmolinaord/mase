close all;
clear all;
clc;

%% Input data

[x, Tnod, Tmat, dat, Tn, mat, data] = input_wing;

%% Step 1:
% Associated parameters calculation

[L, A, I_y, I_z, J, V, m] = associated_parameters(data, x, Tnod, dat, Tmat, mat);

%% Step 2:
% Mass & density calculations

[rho_hat, rho_eff] = density(data, Tmat, m, V, mat);

%% Step 3:
% Thrust.

Te = thrust(x);
fprintf('The thrust provided by the engine is %2.3fkN\n', Te*1e-3)

%% Step 4:
% Stiffness element and global matrix
[Ke, KG, R, Re] = stiffness_matrix(data, Tmat, Tn, mat, dat, A, L, I_z, I_y, J);

%% Step 5:
% Element and global force vector

[Fe, FG] = force_vector(data, x, Tnod, L, Te, rho_eff, A, R, Re, Tn);

%% Step 6:
% Solve the global system

[u, F] = global_system(data, KG, FG);

%% Step 7:
% Obtain the global displacements, rotations and internal forces for each
% element: axial displacements u_p_x, deflections u_p_y and u_p_z,
% rotations angles theta_p_x, theta_p_y and theta_p_z, axial force F, shear
% forces Q_y and Q_z, bending moments M_y and M_z and torsion moment T.

[uint, fint] = local_DisRotFor(data, Tn, F, u, Re, Ke);

%% Step 8:
% Obtain wing displacements along with the internal forces distribution as
% weel as the local deformation, deflection and rotation angles of each
% beam element.

plotWing(x,Tnod,u,uint,fint);
